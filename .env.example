APP_NAME=Doppelganger
APP_ENV=production
DEBUG=false
HOST=0.0.0.0
PORT=8000
BACKEND_PUBLIC_URL=
LOG_LEVEL=INFO
LOG_RAW_MODEL_OUTPUT=true
LOG_MAX_CHARS=6000
CORS_ALLOW_ORIGINS=http://localhost:5173,http://127.0.0.1:5173
CORS_ALLOW_ORIGIN_REGEX=https://.*\\.vercel\\.app

# Required
GEMINI_API_KEY=

# Gemini model routing
GEMINI_PRO_MODEL=gemini-3-pro-preview
GEMINI_FLASH_MODEL=gemini-3-flash-preview
GEMINI_EMBEDDING_MODEL=gemini-embedding-001
GEMINI_EMBEDDING_DIM=3072
GEMINI_EMBEDDING_TEXT_SOURCE=segment_text
GEMINI_FALLBACK_MODELS=gemini-3-pro-preview,gemini-3-flash-preview

CHAT_DATA_PATH=data/chat_data.json
SQLITE_PATH=runtime/doppelganger.db
STYLE_PROFILE_PATH=runtime/style_profile.json
PREFERENCE_PROFILE_PATH=runtime/preference_profile.json
PERSONA_PROFILE_PATH=runtime/persona_profile.json

SEGMENT_IDS_PATH=runtime/rag_segment_ids.npy
SEGMENT_VECTORS_PATH=runtime/rag_segment_vectors.npy
SEGMENT_INDEX_META_PATH=runtime/rag_segment_index_meta.json

TARGET_SENDER=Doppelgänger
USER_SENDER_CANDIDATES=dxa🥰,dxa??,dxa
STRICT_NICKNAME=宝贝
FORBIDDEN_NICKNAMES=亲亲,宝宝,老婆,老公,宝子,乖乖

RETRIEVAL_TOP_K=30
SEMANTIC_ENABLED=true
SEMANTIC_LEXICAL_POOL=100
SEMANTIC_TOP_SEGMENTS=5
SEMANTIC_RECALL_K=120
SEMANTIC_AUTOFILL_MISSING=true
SEMANTIC_AUTOFILL_PER_QUERY=36
SEMANTIC_USE_DENSE_INDEX=true
SEMANTIC_INDEX_AUTO_REFRESH=true
SEMANTIC_REBUILD_ON_START=false
SEMANTIC_BUILD_ON_START_LIMIT=0

SEGMENT_WINDOW_BEFORE=6
SEGMENT_WINDOW_AFTER=8
SEGMENT_MAX_LINES=18
RAG_MAX_SEGMENT_CHARS=1200
RAG_DYNAMIC_WINDOW_ENABLED=true
RAG_DYNAMIC_WINDOW_EXTRA=4
EMBEDDING_BATCH_SIZE=24

GENERATION_CANDIDATES=12
RERANK_TOP_K=6
ONLINE_MEMORY_DAYS=14

ENABLE_OFFTOPIC_PENALTY=true
ENABLE_REPAIR_PASS=true
ENABLE_PERSONA_GUARD=true
OFFTOPIC_PENALTY_WEIGHT=0.22
REPAIR_THRESHOLD_LOW=0.32
REPAIR_THRESHOLD_MID=0.55
REPAIR_THRESHOLD_HIGH=0.76
CONTEXT_FRAME_RECENT_MESSAGES=8
CONTEXT_FRAME_ANCHOR_CHARS=180
PERSONA_GUARD_PENALTY_WEIGHT=0.12
PERSONA_GUARD_REPAIR_THRESHOLD=0.60
PERSONA_CACHE_TTL_SEC=600
PERSONA_CANDIDATE_MIN_SAMPLES=12
PERSONA_CANDIDATE_MIN_PHRASE_FREQ=2
PERSONA_ADAPTIVE_TOP_PHRASES_LIMIT=80
